# üîß –§–∏–∫—Å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ ContainerConfig

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω docker-compose.yml
**–ü—Ä–æ–±–ª–µ–º–∞:** Docker Compose –∏–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ—Ç `${VAR}` –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è **—Ö–æ—Å—Ç–∞**, –∞ –Ω–µ –∏–∑ `env_file`.

**–ë—ã–ª–æ:**
```yaml
environment:
  POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}  # ‚Üê –±–µ—Ä–µ—Ç —Å –•–û–°–¢–ê (–≥–¥–µ –ø—É—Å—Ç–æ!)
  OPENAI_API_KEY: ${OPENAI_API_KEY}       # ‚Üê –±–µ—Ä–µ—Ç —Å –•–û–°–¢–ê (–≥–¥–µ –ø—É—Å—Ç–æ!)
```

**–°—Ç–∞–ª–æ:**
- –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ `.env.prod` —á–µ—Ä–µ–∑ `env_file`
- –í `environment` —Ç–æ–ª—å–∫–æ Docker-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ override'—ã:
  - `POSTGRES_HOST: postgres`
  - `POSTGRES_PORT: 5432`

### 2. –£–±—Ä–∞–Ω –¥—É–±–ª—å --env-file –∏–∑ Makefile
**–ë—ã–ª–æ:**
```bash
docker-compose --env-file .env.prod up -d --build
```

**–°—Ç–∞–ª–æ:**
```bash
docker-compose up -d --build  # env_file —É–∂–µ –≤ docker-compose.yml
```

### 3. –°–æ–∑–¥–∞–Ω safe_redeploy.sh
–°–∫—Ä–∏–ø—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–¥–µ–ø–ª–æ—è –ë–ï–ó –ø–æ—Ç–µ—Ä–∏ –ë–î:
```bash
./scripts/safe_redeploy.sh
```

## –ö–∞–∫ –¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–ë–ï–ó –ø–æ—Ç–µ—Ä–∏ –ë–î):
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–±:
./scripts/safe_redeploy.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
docker-compose down && git pull && docker rm -f soulnear_postgres soulnear_bot soulnear_api 2>/dev/null || true && make rebuild && make logs-bot
```

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–£–î–ê–õ–ò–¢ –ë–î):
```bash
make redeploy  # ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç clean-force —Å -v —Ñ–ª–∞–≥–æ–º!
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "ContainerConfig"

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞:
1. –ú–µ–Ω—è–µ—à—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ docker-compose.yml
2. –°—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–º–µ–µ—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π metadata

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (volumes –æ—Å—Ç–∞—é—Ç—Å—è!)
docker-compose down
docker rm -f soulnear_postgres soulnear_bot soulnear_api 2>/dev/null || true

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
docker-compose up -d --build
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
docker exec soulnear_bot env | grep -E "BOT_TOKEN|OPENAI_API_KEY|POSTGRES"
```

## –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–∞–≤–¥—ã

**–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∂–∏–≤—É—Ç –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ:** `.env.prod` (—Ä—è–¥–æ–º —Å docker-compose.yml)

**–ù–ï –ù–£–ñ–ù–û:**
- ‚ùå –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ shell: `export OPENAI_API_KEY=...`
- ‚ùå –°–æ–∑–¥–∞–≤–∞—Ç—å `.env` –≤ –∫–æ—Ä–Ω–µ
- ‚ùå –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å `.env.prod` –≤–Ω—É—Ç—Ä—å `soul_bot/`

**–ù–£–ñ–ù–û:**
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `/–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É/.env.prod`
- ‚úÖ –≠—Ç–æ—Ç —Ñ–∞–π–ª —á–∏—Ç–∞–µ—Ç—Å—è Docker Compose –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

## –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

1. ‚úÖ –§–∞–π–ª `.env.prod` –Ω–∞ –º–µ—Å—Ç–µ (—Ä—è–¥–æ–º —Å docker-compose.yml)
2. ‚úÖ –í—Å–µ placeholder'—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   - `HELPER_ID`
   - `RELATIONSHIPS_ID`
   - `SECRET_KEY`
3. ‚úÖ `POSTGRES_PASSWORD` –Ω–µ –ø—É—Å—Ç–æ–π
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—à—å `./scripts/safe_redeploy.sh` –∏–ª–∏ `make rebuild`

---

**–¢–µ–ø–µ—Ä—å –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ –º–µ—Å—Ç–µ, –ë–î —Ü–µ–ª–∞. –ö—Ä–∞—Å–æ—Ç–∞! üöÄ**

