# üéâ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à—ë–Ω!

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### ‚úÖ 1. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∞ –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞
- **–ë—ã–ª–æ:** `soul_bot/` –∏ `soul_test_bot/` (–¥—É–±–ª–∏–∫–∞—Ç)
- **–°—Ç–∞–ª–æ:** –û–¥–Ω–∞ –ø–∞–ø–∫–∞ `soul_bot/` —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º

### ‚úÖ 2. –°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤
- `.env.prod` - –ø—Ä–æ–¥–∞–∫—à–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `.env.test` - —Ç–µ—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `.env.example` - —à–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### ‚úÖ 3. –û–±–Ω–æ–≤–ª—ë–Ω config.py
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω—É–∂–Ω–æ–≥–æ .env —Ñ–∞–π–ª–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `ENV` (prod/test/dev)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

### ‚úÖ 4. –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞
- `scripts/run_prod.sh` - –∑–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω
- `scripts/run_test.sh` - –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è .env —Ñ–∞–π–ª–æ–≤

### ‚úÖ 5. –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- `webapp.py` –∏–∑ soul_test_bot –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –≤ soul_bot
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –≤ `__init__.py`

### ‚úÖ 6. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–æ–≤
- `test_refactoring.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤
- `tests/test_config_validation.py` - –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤
- `tests/test_bot_startup.py` - smoke —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞

### ‚úÖ 7. –û–±–Ω–æ–≤–ª—ë–Ω .gitignore
- .env.prod –∏ .env.test –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ git
- –ë—ç–∫–∞–ø—ã –∏—Å–∫–ª—é—á–µ–Ω—ã
- Coverage –æ—Ç—á—ë—Ç—ã –∏—Å–∫–ª—é—á–µ–Ω—ã

---

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –†–∞–Ω—å—à–µ:
```bash
# –ü—Ä–æ–¥–∞–∫—à–Ω
cd soul_bot && python bot.py

# –¢–µ—Å—Ç
cd soul_test_bot && python bot.py

# –ü—Ä–æ–±–ª–µ–º—ã:
# - –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö
# - –ö–æ–¥ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è
# - –¢–æ–∫–µ–Ω—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ
```

### –¢–µ–ø–µ—Ä—å:
```bash
# –ü—Ä–æ–¥–∞–∫—à–Ω
ENV=prod python bot.py

# –¢–µ—Å—Ç
ENV=test python bot.py

# –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
# - –û–¥–∏–Ω –∫–æ–¥, –æ–¥–Ω–æ –º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π
# - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –≤ .env
# - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å .env.dev, .env.staging
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å–¥–µ–ª–∞–Ω–æ)
```bash
cd soul_bot
python test_refactoring.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ ENV –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è (prod/test)
- ‚úÖ TEST —Ñ–ª–∞–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç (False/True)
- ‚úÖ POSTGRES_DB –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è (soul_bot/soul_test_bot)
- ‚úÖ BOT_TOKEN –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚ö†Ô∏è OPENAI_API_KEY - –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤ .env —Ñ–∞–π–ª–∞—Ö

### 2. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

**–ó–∞–ø–æ–ª–Ω–∏ .env.prod –∏ .env.test:**
```bash
# –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª—ã –∏ –≤—Å—Ç–∞–≤—å —Å–≤–æ–∏ –∫–ª—é—á–∏
nano soul_bot/.env.prod
nano soul_bot/.env.test
```

–°–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ `SETUP_ENV.md`

### 3. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π
python test_refactoring.py

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# üéâ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´!
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ "–¥–æ" –∏ "–ø–æ—Å–ª–µ"

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
```
SoulNear/
‚îú‚îÄ‚îÄ soul_bot/          # –ü—Ä–æ–¥–∞–∫—à–Ω (TEST=False, DB=soul_bot)
‚îÇ   ‚îî‚îÄ‚îÄ config.py      # –¢–æ–∫–µ–Ω—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã
‚îî‚îÄ‚îÄ soul_test_bot/     # –¢–µ—Å—Ç (TEST=True, DB=soul_test_bot)  
    ‚îî‚îÄ‚îÄ config.py      # –¢–æ–∫–µ–Ω –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
```
SoulNear/
‚îú‚îÄ‚îÄ soul_bot/              # –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ .env.prod          # –ü—Ä–æ–¥–∞–∫—à–Ω –∫–æ–Ω—Ñ–∏–≥ (—Å–µ–∫—Ä–µ—Ç–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ .env.test          # –¢–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥ (—Å–µ–∫—Ä–µ—Ç–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ .env.example       # –®–∞–±–ª–æ–Ω (–≤ git)
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # –£–º–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ run_prod.sh        # ENV=prod
‚îÇ   ‚îî‚îÄ‚îÄ run_test.sh        # ENV=test
‚îî‚îÄ‚îÄ soul_test_bot/         # (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
```

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

### 1. –ó–∞–ø–æ–ª–Ω–∏ .env —Ñ–∞–π–ª—ã
```bash
# –°–º. SETUP_ENV.md
```

### 2. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
```bash
ENV=test python bot.py   # –î–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è
ENV=prod python bot.py   # –î–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è
```

### 3. –£–¥–∞–ª–∏ soul_test_bot (–∫–æ–≥–¥–∞ —É–±–µ–¥–∏—à—å—Å—è)
```bash
cd /Users/nikitagorokhov/dev/SoulNear
rm -rf soul_test_bot
rm -rf soul_bot_backup soul_test_bot_backup  # –±—ç–∫–∞–ø—ã —Ç–æ–∂–µ
```

### 4. –ó–∞–∫–æ–º–º–∏—Ç—å
```bash
cd soul_bot
git add .
git commit -m "refactor: unified soul_bot and soul_test_bot with .env configs"
git push
```

### 5. –ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ ChatCompletion
–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏ –Ω–∞ –æ–¥–Ω–æ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ!

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–∏—Ç—å dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```bash
cp .env.example .env.dev
# –∑–∞–ø–æ–ª–Ω–∏
ENV=dev python bot.py
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–∞ –±–æ—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1
./scripts/run_prod.sh

# –¢–µ—Ä–º–∏–Ω–∞–ª 2
./scripts/run_test.sh
```

### CI/CD
GitHub Actions —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω! –°–º. `.github/workflows/tests.yml`

---

## –ë—ç–∫–∞–ø—ã

–ë—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π:
- `soul_bot_backup/`
- `soul_test_bot_backup/`

–ú–æ–∂–µ—à—å —É–¥–∞–ª–∏—Ç—å —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é, –∫–æ–≥–¥–∞ —É–±–µ–¥–∏—à—å—Å—è —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## –ò—Ç–æ–≥–∏

‚úÖ –ö–æ–¥ –æ–±—ä–µ–¥–∏–Ω—ë–Ω  
‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞  
‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞  
‚úÖ –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞  

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~15 –º–∏–Ω—É—Ç  
**–°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –±—É–¥—É—â–µ–º:** –±–µ—Å—Ü–µ–Ω–Ω–æ üöÄ

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å:

1. **–û—Ç–∫–∞—Ç –∏–∑ –±—ç–∫–∞–ø–∞:**
```bash
rm -rf soul_bot
cp -r soul_bot_backup soul_bot
```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
tail -f soul_bot/log.txt
```

3. **Debug:**
```bash
ENV=test python -c "import config; print(config.ENV, config.TEST, config.POSTGRES_DB)"
```

---

üéâ **Refactoring Complete!** Enjoy your clean codebase!


