# üéØ –ß–¢–û –î–ï–õ–ê–¢–¨ –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°

## –°–∏—Ç—É–∞—Ü–∏—è
–£ —Ç–µ–±—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—à–∏–±–∫–∞:
```
ERROR ‚Ä∫ CREATE DATABASE cannot run inside a transaction block
```

## üìå –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ (2 –º–∏–Ω—É—Ç—ã)

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```bash
git pull
```

–¢—ã –ø–æ–ª—É—á–∏—à—å:
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `database.py` (—Ç–µ–ø–µ—Ä—å CREATE DATABASE —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –°–∫—Ä–∏–ø—Ç `FIX_DB_ISSUE.sh` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–∏–∫—Å–∞
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `safe_redeploy.sh` —Å —Ñ–ª–∞–≥–æ–º `--clean`

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏ fix —Å–∫—Ä–∏–ø—Ç
```bash
./FIX_DB_ISSUE.sh
```

–ò–ª–∏ –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π:
```bash
chmod +x FIX_DB_ISSUE.sh
./FIX_DB_ISSUE.sh
```

**–ß—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç:**
1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
2. –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π postgres volume (—Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç init-db.sh)
3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç –≤—Å—ë —Å –Ω—É–ª—è
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∏

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–î–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å –≤ –ª–æ–≥–∞—Ö:
```
‚úÖ Database connected successfully
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚ùå `CREATE DATABASE cannot run inside a transaction`
- ‚ùå `Database 'soul_bot' missing, creating...`

---

## üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π safe_redeploy.sh
```bash
./scripts/safe_redeploy.sh --clean
```

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –í—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∫–æ–Ω—Ç—Ä–æ–ª—å)
```bash
# 1. –°—Ç–æ–ø
docker-compose down

# 2. –ß–∏—Å—Ç–∫–∞
docker rm -f soulnear_postgres soulnear_bot soulnear_api
docker volume rm soulnear_postgres_data

# 3. –°—Ç–∞—Ä—Ç
docker-compose up -d --build

# 4. –õ–æ–≥–∏ (—á–µ—Ä–µ–∑ 10 —Å–µ–∫)
sleep 10 && docker-compose logs --tail=50 bot
```

---

## ü§î –ü—Ä–æ WARNING: The POSTGRES_PASSWORD variable is not set

**–≠—Ç–æ –ù–ï –ø—Ä–æ–±–ª–µ–º–∞!**

–≠—Ç–æ—Ç warning –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—à—å `docker-compose down` **–î–û** `git pull` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è docker-compose.yml.

–ü–æ—Å–ª–µ `git pull` –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–ò–≥–Ω–æ—Ä–∏—Ä—É–π –µ–≥–æ.** 

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ

```bash
# 1. –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã UP
docker-compose ps

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# soulnear_postgres   Up (healthy)
# soulnear_bot        Up
# soulnear_api        Up

# 2. –õ–æ–≥–∏ –±–µ–∑ –æ—à–∏–±–æ–∫
docker-compose logs --tail=100 bot | grep -i error

# –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å CREATE DATABASE –æ—à–∏–±–æ–∫

# 3. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç
# –ó–∞–π–¥–∏ –≤ Telegram, –æ—Ç–ø—Ä–∞–≤—å /start
```

---

## üöÄ –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–ø–ª–æ–∏

**–° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ë–î:**
```bash
./scripts/safe_redeploy.sh
```

**–° –æ—á–∏—Å—Ç–∫–æ–π –ë–î (fresh start):**
```bash
./scripts/safe_redeploy.sh --clean
```

---

## üìö –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –£–±—Ä–∞–Ω—ã `${VAR}` –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –∏–∑ docker-compose.yml
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env.prod`
- ‚úÖ –ù–µ—Ç warning'–æ–≤

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ë–î
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ –≤ `database.py` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AUTOCOMMIT)
- ‚úÖ –¢–µ–ø–µ—Ä—å –±–æ—Ç –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ë–î —Å–∞–º –µ—Å–ª–∏ init-db.sh –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
- ‚úÖ –°–∫—Ä–∏–ø—Ç `FIX_DB_ISSUE.sh` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–∏–∫—Å–∞

### 3. –î–µ–ø–ª–æ–π
- ‚úÖ `safe_redeploy.sh` —Å —Ñ–ª–∞–≥–æ–º `--clean`
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üí¨ –ö–æ—Ä–æ—Ç–∫–æ

```bash
# –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
git pull
./FIX_DB_ISSUE.sh

# –í—Å—ë. –†–∞–±–æ—Ç–∞–µ—Ç.
```

---

**–í–æ–ø—Ä–æ—Å—ã? –°–º–æ—Ç—Ä–∏ `QUICK_FIX_NOW.md` –∏–ª–∏ `DEPLOY_CHEATSHEET.md`** üöÄ

