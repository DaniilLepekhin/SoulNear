# ðŸš€ ÐšÐ°Ðº Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Soul Bot â€” Ð´Ð»Ñ Ð»ÐµÐ½Ð¸Ð²Ñ‹Ñ…

## Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### 1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
```bash
cd soul_bot
pip install -r requirements-test.txt
```

### 2. Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²
```bash
# Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° (10-20 ÑÐµÐº)
./run_tests.sh quick

# Ð’ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹
./run_tests.sh

# Ð¢Ð¾Ð»ÑŒÐºÐ¾ unit
./run_tests.sh unit

# Ð¡ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸ÐµÐ¼ ÐºÐ¾Ð´Ð°
./run_tests.sh coverage
```

---

## Workflow Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ (Ð‘Ð•Ð— Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹)

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð±Ð¾Ñ‚Ñ‹ (Ð¡ÐÐœÐ«Ð™ ÐŸÐ ÐžÐ¡Ð¢ÐžÐ™)

```bash
# 1. Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ð² soul_test_bot
cd ../soul_test_bot
# ... Ð¿Ð¸ÑˆÐµÐ¼ ÐºÐ¾Ð´ ...

# 2. Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ test Ð±Ð¾Ñ‚
python bot.py

# 3. Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð² Telegram (@YourTestBot)

# 4. Ð•ÑÐ»Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ â€” ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ð² soul_bot
cp -r bot/* ../soul_bot/bot/
cp -r database/* ../soul_bot/database/

# 5. ÐŸÑ€Ð¾Ð³Ð¾Ð½ÑÐµÐ¼ Ñ‚ÐµÑÑ‚Ñ‹
cd ../soul_bot
./run_tests.sh

# 6. ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ð¼
git add .
git commit -m "feat: Ð½Ð¾Ð²Ð°Ñ Ñ„Ð¸Ñ‡Ð°"
git push
```

**ÐŸÑ€Ð¾Ñ„Ð¸Ñ‚:** ÐŸÑ€Ð¾Ð´Ð°ÐºÑˆÐ½ Ð±Ð¾Ñ‚ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ, Ð¿Ð¾ÐºÐ° Ñ‚Ñ‹ ÑÐºÑÐ¿ÐµÑ€Ð¸Ð¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐµÑˆÑŒ.

---

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Feature Flags (Ð´Ð»Ñ Ð¾Ð¿Ñ‹Ñ‚Ð½Ñ‹Ñ…)

```python
# 1. Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð² config.py
USE_NEW_FEATURE = os.getenv('USE_NEW_FEATURE', 'false') == 'true'

# 2. Ð’ ÐºÐ¾Ð´Ðµ
if USE_NEW_FEATURE:
    # Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð´
    result = await new_function()
else:
    # ÑÑ‚Ð°Ñ€Ñ‹Ð¹ ÐºÐ¾Ð´
    result = await old_function()

# 3. Ð’ÐºÐ»ÑŽÑ‡Ð¸ Ð´Ð»Ñ ÑÐµÐ±Ñ
export USE_NEW_FEATURE=true
python bot.py

# 4. ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð» â†’ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸
export USE_NEW_FEATURE=false

# 5. Ð”ÐµÐ¿Ð»Ð¾Ð¹ â†’ Ð²ÐºÐ»ÑŽÑ‡Ð¸ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¿Ð¾ÑÑ‚ÐµÐ¿ÐµÐ½Ð½Ð¾
```

---

## Pre-commit hook (Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ñ€Ð¾Ð³Ð¾Ð½)

Ð§Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð·Ð°Ð±Ñ‹Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ñ‹:

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ .git/hooks/pre-commit
cat > .git/hooks/pre-commit << 'EOF'
#!/bin/bash
echo "ðŸ§ª Ð—Ð°Ð¿ÑƒÑÐº smoke Ñ‚ÐµÑÑ‚Ð¾Ð² Ð¿ÐµÑ€ÐµÐ´ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð¼..."
./run_tests.sh smoke

if [ $? -ne 0 ]; then
    echo "âŒ Ð¢ÐµÑÑ‚Ñ‹ Ð½Ðµ Ð¿Ñ€Ð¾ÑˆÐ»Ð¸! ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‘Ð½."
    exit 1
fi

echo "âœ… Ð¢ÐµÑÑ‚Ñ‹ Ð¿Ñ€Ð¾ÑˆÐ»Ð¸! ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚ Ñ€Ð°Ð·Ñ€ÐµÑˆÑ‘Ð½."
EOF

chmod +x .git/hooks/pre-commit
```

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¿Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ `git commit` Ñ‚ÐµÑÑ‚Ñ‹ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸!

---

## ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸

### Ð›Ð¾Ð³Ð¸ Ð² Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ðµ
```bash
# Ð¢ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» 1 - Ð±Ð¾Ñ‚
python bot.py

# Ð¢ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» 2 - Ð»Ð¾Ð³Ð¸
tail -f log.txt | grep -E "(ERROR|WARNING|ALARM)"
```

### ÐÐ»ÐµÑ€Ñ‚Ñ‹ ÑƒÐ¶Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹
Ð’ÑÐµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð»ÐµÑ‚ÑÑ‚ Ð² Telegram (ID 73744901)

---

## Ð§ÐµÐº-Ð»Ð¸ÑÑ‚ Ð¿ÐµÑ€ÐµÐ´ ÑÐ½Ð¾Ð¼

1. âœ… ÐŸÑ€Ð¾Ð³Ð½Ð°Ð» smoke Ñ‚ÐµÑÑ‚Ñ‹: `./run_tests.sh smoke`
2. âœ… ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð» Ð² test Ð±Ð¾Ñ‚Ðµ (5 Ð¼Ð¸Ð½ÑƒÑ‚)
3. âœ… Ð—Ð°ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ð»: `git commit -m "..."`
4. âœ… GitHub Actions Ð¿Ñ€Ð¾ÑˆÑ‘Ð» (Ð·ÐµÐ»Ñ‘Ð½Ð°Ñ Ð³Ð°Ð»Ð¾Ñ‡ÐºÐ°)
5. âœ… Ð—Ð°Ð´ÐµÐ¿Ð»Ð¾Ð¸Ð» Ð½Ð° Ð¿Ñ€Ð¾Ð´
6. âœ… ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ» Ð»Ð¾Ð³Ð¸ 15 Ð¼Ð¸Ð½ÑƒÑ‚

Ð’ÑÑ‘. Ð˜Ð´Ð¸ ÑÐ¿Ð°Ñ‚ÑŒ. Ð•ÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ ÑÐ»Ð¾Ð¼Ð°ÐµÑ‚ÑÑ â€” Telegram Ð°Ð»ÐµÑ€Ñ‚ Ñ€Ð°Ð·Ð±ÑƒÐ´Ð¸Ñ‚ ðŸ˜„

---

## ÐžÑ‚ÐºÐ°Ñ‚ Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ…

### Ð•ÑÐ»Ð¸ feature flag:
```bash
export USE_CHAT_COMPLETION=false
# Ð¸Ð»Ð¸ Ð² ÐºÐ¾Ð´Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð´ÐµÑ„Ð¾Ð»Ñ‚
```

### Ð•ÑÐ»Ð¸ Ð±ÐµÐ· Ñ„Ð»Ð°Ð³Ð¾Ð²:
```bash
git revert HEAD  # Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚
# Ð¸Ð»Ð¸
git reset --hard HEAD~1  # ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚ (ÐžÐ¡Ð¢ÐžÐ ÐžÐ–ÐÐž!)
```

### Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐ½ ÑƒÐ¿Ð°Ð»:
```bash
# 1. Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð¾Ñ‚ÐºÐ°Ñ‚
cd soul_bot
git checkout main  # Ð¸Ð»Ð¸ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ð¹ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚
git pull
sudo systemctl restart soul_bot  # Ð¸Ð»Ð¸ ÐºÐ°Ðº Ñƒ Ñ‚ÐµÐ±Ñ

# 2. Ð Ð°Ð·Ð±Ð¸Ñ€Ð°ÐµÐ¼ÑÑ Ñ Ð±Ð°Ð³Ð¾Ð¼ Ð² soul_test_bot
cd ../soul_test_bot
# ... Ñ‡Ð¸Ð½Ð¸Ð¼ ...

# 3. Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼
./run_tests.sh
python bot.py

# 4. Ð—Ð°Ð»Ð¸Ð²Ð°ÐµÐ¼ Ñ„Ð¸ÐºÑ
cd ../soul_bot
cp -r ../soul_test_bot/bot/* bot/
git add .
git commit -m "fix: Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ð» Ð±Ð°Ð³ X"
git push
```

---

## Ð”ÐµÐ±Ð°Ð³ ÑƒÐ¿Ð°Ð²ÑˆÐ¸Ñ… Ñ‚ÐµÑÑ‚Ð¾Ð²

```bash
# 1. Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ð¼ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð¼
pytest tests/unit/test_openai_service.py::TestOpenAIService::test_build_system_prompt_basic -vv

# 2. Ð¡ Ð´ÐµÐ±Ð°Ð³Ð³ÐµÑ€Ð¾Ð¼ (Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐµ)
pytest --pdb tests/unit/test_openai_service.py

# 3. ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ print() Ð² Ñ‚ÐµÑÑ‚Ð°Ñ…
pytest -s tests/

# 4. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÑƒÐ¿Ð°Ð²ÑˆÐ¸Ð¹ Ñ‚ÐµÑÑ‚
pytest --lf
```

---

## ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ ÑÐ»Ð¾Ð¼Ð°Ð»Ð¾ÑÑŒ"

```bash
# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: ÐÐ²Ñ‚Ð¾Ñ‚ÐµÑÑ‚Ñ‹ (30 ÑÐµÐº)
./run_tests.sh smoke

# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð ÑƒÑ‡Ð½Ð°Ñ (2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹)
python bot.py  # Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾
# Ð—Ð°Ð¹Ð´Ð¸ Ð² Ð±Ð¾Ñ‚Ð°, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒ:
# 1. Ð¢ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
# 2. Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ðµ
# 3. /menu
# Ð•ÑÐ»Ð¸ Ð²ÑÑ‘ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¾ â€” ÐžÐš

# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 3: ÐÐ° test Ð±Ð¾Ñ‚Ðµ (5 Ð¼Ð¸Ð½ÑƒÑ‚)
cd ../soul_test_bot
python bot.py
# ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ» Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
```

---

## FAQ

**Q: ÐÑƒÐ¶Ð½Ð¾ Ð»Ð¸ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ð¶Ð´ÑƒÑŽ Ð¼ÐµÐ»Ð¾Ñ‡ÑŒ?**  
A: ÐÐµÑ‚. Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¿ÑƒÑ‚Ð¸ (ÑÐ¼. TEST_PLAN.md). ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ â€” Ð¿Ð¾ Ð¶ÐµÐ»Ð°Ð½Ð¸ÑŽ.

**Q: Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ, ÐµÑÐ»Ð¸ Ñ‚ÐµÑÑ‚Ñ‹ Ð´Ð¾Ð»Ð³Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚?**  
A: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ `./run_tests.sh quick` â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ unit + smoke, < 20 ÑÐµÐº.

**Q: ÐœÐ¾Ð¶Ð½Ð¾ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð±ÐµÐ· Ñ‚ÐµÑÑ‚Ð¾Ð²?**  
A: ÐœÐ¾Ð¶Ð½Ð¾, Ð½Ð¾ Ñ€Ð¸ÑÐºÐ¾Ð²Ð°Ð½Ð½Ð¾. ÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼ â€” smoke Ñ‚ÐµÑÑ‚Ñ‹ Ð¿ÐµÑ€ÐµÐ´ Ð´ÐµÐ¿Ð»Ð¾ÐµÐ¼.

**Q: GitHub Actions Ð¿Ð°Ð´Ð°ÐµÑ‚, Ð° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚?**  
A: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð² `.github/workflows/tests.yml`

**Q: ÐšÐ°Ðº Ð¼Ð¾ÐºÐ°Ñ‚ÑŒ OpenAI API?**  
A: Ð£Ð¶Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¾ Ð² `conftest.py`. ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ `mock_openai_response`.

---

## Ð˜Ñ‚Ð¾Ð³Ð¾: Zero Effort Testing

1. **ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ pre-commit hook** (1 Ñ€Ð°Ð·)
2. **ÐŸÐ¸ÑˆÐ¸ ÐºÐ¾Ð´** Ð² `soul_test_bot`
3. **ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚ÑŒÑÑ** â†’ Ñ‚ÐµÑÑ‚Ñ‹ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
4. **GitHub Actions** Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·
5. **Ð”ÐµÐ¿Ð»Ð¾Ð¹** â†’ Ð°Ð»ÐµÑ€Ñ‚Ñ‹ Ð² Telegram

Ð’ÑÑ‘. Ð¢Ñ‹ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð½Ðµ Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ Ð¾ Ñ‚ÐµÑÑ‚Ð°Ñ…, Ð¾Ð½Ð¸ ÑÐ°Ð¼Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ ðŸ¤–

