"""
üì¢ Broadcast Messages Handler

–û–±—â–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–∞–∂–µ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π).
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 1-2 –¥–Ω—è, –≤—Å–µ–≥–æ 15 —Å–æ–æ–±—â–µ–Ω–∏–π.
"""
from datetime import datetime
from bot.loader import bot
import database.repository.user as db_user


# 15 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ–±—â–µ–π —Ä–∞—Å—Å—ã–ª–∫–∏ (—á–µ—Ä–µ–¥—É—é—Ç—Å—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞ –∏ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è)
BROADCAST_MESSAGES = [
    # 1. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞
    "–¢–µ–±–µ –ø–æ—Å–ª–∞–Ω–∏–µ: —Å–µ–≥–æ–¥–Ω—è –Ω–µ –Ω—É–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–º. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –±—ã—Ç—å –≤ –∫–æ–Ω—Ç–∞–∫—Ç–µ —Å —Å–æ–±–æ–π.",

    # 2. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞
    "–¢–µ–±–µ –ø–æ—Å–ª–∞–Ω–∏–µ: –µ—Å–ª–∏ —É—Å—Ç–∞–ª ‚Äî –æ—Ç–¥–æ—Ö–Ω–∏. –ù–∏–∫–æ–º—É –Ω–µ –Ω—É–∂–Ω–æ —ç—Ç–æ –æ–±—ä—è—Å–Ω—è—Ç—å.",

    # 3. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞
    "–¢–µ–±–µ –ø–æ—Å–ª–∞–Ω–∏–µ: –ø—Ä–∏—Å–ª—É—à–∞–π—Å—è –∫ —Ç–µ–ª—É. –ß—Ç–æ –µ–º—É —Å–µ–π—á–∞—Å –Ω—É–∂–Ω–æ: –Ω–µ–º–Ω–æ–≥–æ –≤–æ–¥—ã, –¥–≤–∏–∂–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ç–∏—à–∏–Ω—ã?",

    # 4. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞
    "–¢–µ–±–µ –ø–æ—Å–ª–∞–Ω–∏–µ: –Ω–µ –ø—ã—Ç–∞–π—Å—è –ø–æ–Ω—è—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É. –ò–Ω–æ–≥–¥–∞ –ø–∞—É–∑–∞ –¥–∞—ë—Ç –±–æ–ª—å—à–µ, —á–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏—è.",

    # 5. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞
    "–¢–µ–±–µ –ø–æ—Å–ª–∞–Ω–∏–µ: –≤—Å–ø–æ–º–Ω–∏ —Ö–æ—Ç—å –æ–¥–Ω–æ, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è. –î–∞–∂–µ –º–µ–ª–æ—á—å ‚Äî —ç—Ç–æ —É–∂–µ –¥–≤–∏–∂–µ–Ω–∏–µ.",

    # 6. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞
    "–¢–µ–±–µ –ø–æ—Å–ª–∞–Ω–∏–µ: –ø–æ—Å–º–æ—Ç—Ä–∏, —á—Ç–æ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —Ö–æ—Ä–æ—à–µ–≥–æ. –ß–∞—Å—Ç–æ —ç—Ç–æ–≥–æ –±–æ–ª—å—à–µ, —á–µ–º –º—ã –∑–∞–º–µ—á–∞–µ–º.",

    # 7. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞
    "–¢–µ–±–µ –ø–æ—Å–ª–∞–Ω–∏–µ: –µ—Å–ª–∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Å—å. –ü—É—Å—Ç—å –º–∏—Ä –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥—ë—Ç.",

    # 8. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è
    "–ö–∞–∫ —Ç–µ–±–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å? –ë—ã–ª –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ —Å—Ç–∞–ª–æ —Å–ø–æ–∫–æ–π–Ω–µ–µ –∏–ª–∏, –Ω–∞–æ–±–æ—Ä–æ—Ç, –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–µ–µ? –ï—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è ‚Äî –º–æ–∂–µ–º –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å.",

    # 9. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è
    "–ß—Ç–æ —Å–µ–π—á–∞—Å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∑–∞–Ω–∏–º–∞–µ—Ç –≥–æ–ª–æ–≤—É? –ù–∞–ø–∏—à–∏ –ø–∞—Ä—É —Å–ª–æ–≤ ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏–º –≤–º–µ—Å—Ç–µ, —á—Ç–æ –∑–∞ —ç—Ç–∏–º —Å—Ç–æ–∏—Ç.",

    # 10. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è
    "–ß—Ç–æ —Å–µ–≥–æ–¥–Ω—è –ø–æ–ª—É—á–∏–ª–æ—Å—å –±–µ–∑ —É—Å–∏–ª–∏–π? –ò–Ω–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ–º –≤–∏–¥–Ω–æ, —á—Ç–æ —Ç–µ–±–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç.",

    # 11. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è
    "–ë—ã–ª–æ –ª–∏ —á—Ç–æ-—Ç–æ, —á—Ç–æ —Ö–æ—Ç–µ–ª(–∞) —Å–∫–∞–∑–∞—Ç—å, –Ω–æ –Ω–µ —Ä–µ—à–∏–ª—Å—è(–∞—Å—å)? –ú–æ–∂–µ—à—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è ‚Äî —è —Ä—è–¥–æ–º.",

    # 12. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è
    "–ï—Å–ª–∏ –±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–¥–∞—Ç—å –æ–¥–∏–Ω —á–µ—Å—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å –æ —Å–µ–±–µ ‚Äî –∫–∞–∫–æ–π –±—ã —Ç—ã –≤—ã–±—Ä–∞–ª(–∞)? –ù–∞–ø–∏—à–∏, –æ–±—Å—É–¥–∏–º.",

    # 13. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è
    "–ï—Å—Ç—å –º—ã—Å–ª—å, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –æ—Ç–ø—É—Å–∫–∞–µ—Ç? –†–∞—Å—Å–∫–∞–∂–∏, –ø–æ–ø—Ä–æ–±—É–µ–º –≤–º–µ—Å—Ç–µ –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –æ–Ω–∞ —Ü–µ–ø–ª—è–µ—Ç.",

    # 14. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è
    "–ë—ã–≤–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ö–æ—á–µ—Ç—Å—è –≤—ã–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è, –±–µ–∑ —Å–æ–≤–µ—Ç–æ–≤ –∏ –æ—Ü–µ–Ω–æ–∫. –ú–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å —Å—é–¥–∞ ‚Äî —Å–ª—É—à–∞—é.",

    # 15. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è
    "–ü–µ—Ä–µ–¥ —Å–Ω–æ–º –≤—Å–ø–æ–º–Ω–∏, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –±—ã–ª–æ –ø—Ä–∏—è—Ç–Ω—ã–º, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –º–µ–ª–æ—á—å. –•–æ—á–µ—à—å ‚Äî –Ω–∞–ø–∏—à–∏, —è –ø–æ–º–æ–≥—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ."
]


async def send_next_broadcast_message(user_id: int):
    """
    –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ broadcast —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    """
    user = await db_user.get(user_id)

    if not user:
        return

    # –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    msg_index = user.last_broadcast_message
    if msg_index >= len(BROADCAST_MESSAGES):
        return  # –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è

    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å
    try:
        await bot.send_message(
            user_id,
            BROADCAST_MESSAGES[msg_index],
            parse_mode='HTML'
        )

        # –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
        await db_user.update(
            user_id=user_id,
            last_broadcast_message=msg_index + 1,
            last_broadcast_sent=datetime.now()
        )

    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ broadcast —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
