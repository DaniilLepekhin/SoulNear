# üìã –≠—Ç–∞–ø 1: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ ChatCompletion API - –ü—Ä–æ–≥—Ä–µ—Å—Å

**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üöÄ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1.1 –ú–æ–¥–µ–ª–∏ –ë–î ‚úÖ (–ó–∞–≤–µ—Ä—à–µ–Ω–æ)

**–°–æ–∑–¥–∞–Ω–æ:**
- ‚úÖ `database/models/user_profile.py` - –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `database/models/conversation_history.py` - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ `database/models/quiz_session.py` - —Å–µ—Å—Å–∏–∏ –∫–≤–∏–∑–æ–≤

**Repository —Å–ª–æ–π:**
- ‚úÖ `database/repository/user_profile.py` (10 –º–µ—Ç–æ–¥–æ–≤)
- ‚úÖ `database/repository/conversation_history.py` (8 –º–µ—Ç–æ–¥–æ–≤)
- ‚úÖ `database/repository/quiz_session.py` (11 –º–µ—Ç–æ–¥–æ–≤)

**–¢–∞–±–ª–∏—Ü—ã –≤ –ë–î:**
- ‚úÖ `user_profiles`
- ‚úÖ `conversation_history`
- ‚úÖ `quiz_sessions`

---

## üöß –¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ openai_service.py

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
- [ ] –°–æ–∑–¥–∞—Ç—å `bot/services/openai_service.py`
- [ ] –§—É–Ω–∫—Ü–∏—è `get_chat_completion()` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
- [ ] –§—É–Ω–∫—Ü–∏—è `build_system_prompt()` - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç
- [ ] –§—É–Ω–∫—Ü–∏—è `save_message()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
- [ ] –§—É–Ω–∫—Ü–∏—è `get_conversation_history()` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
- [ ] Feature flag: `USE_CHAT_COMPLETION`

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏

### 1.3 –ú–∏–≥—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `bot/functions/ChatGPT.py` —Å feature flag
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ helper handler
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ sleeper handler
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤—Å–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã

### 1.4 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è openai_service
- [ ] Integration —Ç–µ—Å—Ç—ã
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (regression checklist)
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ TEST vs PROD

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~700 (—Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª–∏ –∏ repository)
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** 0% (–ø–æ–∫–∞)
- **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ~1 —á–∞—Å
- **–û—Å—Ç–∞–ª–æ—Å—å –∑–∞–¥–∞—á:** 3

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞

- [ ] ‚úÖ ChatCompletion API —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] ‚úÖ Feature flag —Ä–∞–±–æ—Ç–∞–µ—Ç (–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è)
- [ ] ‚úÖ –í—Å–µ smoke —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ
- [ ] ‚úÖ Regression checklist –ø—Ä–æ–π–¥–µ–Ω
- [ ] ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ ‚â• —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏

---

**–°–ª–µ–¥—É—é—â–∏–π update:** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è openai_service.py
