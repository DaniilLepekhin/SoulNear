# üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –≤–æ—Ä–æ–Ω–æ–∫

## –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –≤–æ—Ä–æ–Ω–∫—É –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–ª–∞–º–Ω–æ–π —Å—Å—ã–ª–∫–∏:

### –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂:
1. **–ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ** ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–Ω—É–ª –Ω–∞ —Ä–µ–∫–ª–∞–º—É
2. **–ù–∞—á–∞–ª–æ –∫–≤–∏–∑–∞** ‚Üí –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å"
3. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–∏–∑–∞** ‚Üí –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
4. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞** ‚Üí –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª 5 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
5. **–ü–æ–ª—É—á–µ–Ω–∏–µ retention** ‚Üí –ø–æ–ª—É—á–∏–ª –¥–æ–ø—Ä–æ–¥–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ –∫—É–ø–∏–ª)
6. **–ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏** ‚Üí –æ–ø–ª–∞—Ç–∏–ª –ø–æ–¥–ø–∏—Å–∫—É

---

## –†–µ–∫–ª–∞–º–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### ‚ù§Ô∏è –û—Ç–Ω–æ—à–µ–Ω–∏—è
```
https://t.me/SoulnearBot?start=analysis_relationships_ads
```

### üí∞ –î–µ–Ω—å–≥–∏
```
https://t.me/SoulnearBot?start=analysis_money_ads
```

### üéØ –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
```
https://t.me/SoulnearBot?start=analysis_purpose_ads
```

---

## –ö–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### –í–∞—Ä–∏–∞–Ω—Ç 1: SQL –∑–∞–ø—Ä–æ—Å (–±—ã—Å—Ç—Ä–æ)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh -p 61943 root@37.221.127.100

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –≥–ª–∞–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å
docker exec -i soulnear_postgres psql -U postgres -d soul_bot <<'SQL'
SELECT
    raw_link as "–°—Å—ã–ª–∫–∞",
    COUNT(DISTINCT de.user_id) as "1Ô∏è‚É£ –ü–µ—Ä–µ—Ö–æ–¥–æ–≤",
    COUNT(DISTINCT CASE WHEN qs.id IS NOT NULL THEN de.user_id END) as "2Ô∏è‚É£ –ù–∞—á–∞–ª–∏ –∫–≤–∏–∑",
    COUNT(DISTINCT CASE WHEN qs.status = 'completed' THEN de.user_id END) as "3Ô∏è‚É£ –ó–∞–≤–µ—Ä—à–∏–ª–∏ –∫–≤–∏–∑",
    COUNT(DISTINCT CASE WHEN u.free_messages_activated = true THEN de.user_id END) as "4Ô∏è‚É£ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫",
    COUNT(DISTINCT CASE WHEN u.last_retention_sent IS NOT NULL THEN de.user_id END) as "5Ô∏è‚É£ –ü–æ–ª—É—á–∏–ª–∏ retention",
    COUNT(DISTINCT CASE WHEN u.sub_date > NOW() THEN de.user_id END) as "6Ô∏è‚É£ –ö—É–ø–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É",
    ROUND(100.0 * COUNT(DISTINCT CASE WHEN qs.status = 'completed' THEN de.user_id END) / NULLIF(COUNT(DISTINCT de.user_id), 0), 1) as "CR –∫–≤–∏–∑ %",
    ROUND(100.0 * COUNT(DISTINCT CASE WHEN u.free_messages_activated = true THEN de.user_id END) / NULLIF(COUNT(DISTINCT de.user_id), 0), 1) as "CR –ø–æ–¥–∞—Ä–æ–∫ %",
    ROUND(100.0 * COUNT(DISTINCT CASE WHEN u.sub_date > NOW() THEN de.user_id END) / NULLIF(COUNT(DISTINCT de.user_id), 0), 1) as "CR –ø–æ–¥–ø–∏—Å–∫–∞ %"
FROM
    deeplink_events de
LEFT JOIN
    quiz_sessions qs ON de.quiz_session_id = qs.id
LEFT JOIN
    users u ON de.user_id = u.user_id
WHERE
    de.raw_link IN ('analysis_relationships_ads', 'analysis_money_ads', 'analysis_purpose_ads')
GROUP BY
    de.raw_link
ORDER BY
    COUNT(DISTINCT de.user_id) DESC;
SQL
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Python —Å–∫—Ä–∏–ø—Ç (–∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á–µ—Ç)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /home/metaflexer/SoulNear/soul_bot
python analytics_report.py
```

–í—ã–≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç —Å —ç–∫–æ–Ω–æ–º–∏–∫–æ–π (ROI, CPA, –≤—ã—Ä—É—á–∫–∞).

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–æ—Ç–æ–≤—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

–í —Ñ–∞–π–ª–µ [analytics_queries.sql](analytics_queries.sql) –µ—Å—Ç—å 8 –≥–æ—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

1. üî• **–ì–ª–∞–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ–±–∑–æ—Ä –≤—Å–µ—Ö –≤–æ—Ä–æ–Ω–æ–∫
2. **–î–µ—Ç–∞–ª—å–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞** - –ø–æ—à–∞–≥–æ–≤–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è –¥–ª—è –æ–¥–Ω–æ–π —Å—Å—ã–ª–∫–∏
3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –¥–Ω—è–º** - –¥–∏–Ω–∞–º–∏–∫–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
4. **–í—Ä–µ–º—è –¥–æ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏** - –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–∫—É–ø–∞—é—Ç
5. **Retention –∞–Ω–∞–ª–∏–∑** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ–ø—Ä–æ–¥–∞–∂
6. **–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É —é–∑–µ—Ä—É
7. **A/B —Ç–µ—Å—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π** - –∫–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ª—É—á—à–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ç
8. **–ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑** - –∫–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º

---

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
====================================================================================================
üìä –û–¢–ß–ï–¢ –ü–û –ö–û–ù–í–ï–†–°–ò–ò –†–ï–ö–õ–ê–ú–ù–´–• –í–û–†–û–ù–û–ö
====================================================================================================
–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: 2025-11-15 09:30:00
====================================================================================================

====================================================================================================
  ‚ù§Ô∏è  –û—Ç–Ω–æ—à–µ–Ω–∏—è
  –°—Å—ã–ª–∫–∞: https://t.me/SoulnearBot?start=analysis_relationships_ads
====================================================================================================

  üìà –í–û–†–û–ù–ö–ê:
     1Ô∏è‚É£  –ü–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Å—ã–ª–∫–µ:             3
     2Ô∏è‚É£  –ù–∞—á–∞–ª–∏ –∫–≤–∏–∑:                     2  ( 66.7%)
     3Ô∏è‚É£  –ó–∞–≤–µ—Ä—à–∏–ª–∏ –∫–≤–∏–∑:                  1  ( 33.3%)
     4Ô∏è‚É£  –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫:            1  ( 33.3%)
     5Ô∏è‚É£  –ü–æ–ª—É—á–∏–ª–∏ retention:              0  (  0.0%)
     6Ô∏è‚É£  –ö—É–ø–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É:                 1  ( 33.3%)

  üéØ –ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò:
     ‚Ä¢ CR (–ø–µ—Ä–µ—Ö–æ–¥ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–∏–∑–∞):  33.3%
     ‚Ä¢ CR (–ø–µ—Ä–µ—Ö–æ–¥ ‚Üí –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞): 33.3%
     ‚Ä¢ CR (–ø–µ—Ä–µ—Ö–æ–¥ ‚Üí –ø–æ–∫—É–ø–∫–∞):           33.3%  üî•

  üí∏ –≠–ö–û–ù–û–ú–ò–ö–ê (–ø—Ä–∏ CPL = 100‚ÇΩ):
     ‚Ä¢ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ —Ä–µ–∫–ª–∞–º—É:      300‚ÇΩ
     ‚Ä¢ CPA (—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏):   300‚ÇΩ
     ‚Ä¢ –í—ã—Ä—É—á–∫–∞ (500‚ÇΩ/–ø–æ–¥–ø–∏—Å–∫–∞):   500‚ÇΩ
     ‚Ä¢ ROI:                        66%  ‚úÖ
```

---

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### CR (Conversion Rate)
- **CR –∫–≤–∏–∑** - –∫–æ–Ω–≤–µ—Ä—Å–∏—è –æ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–≤–∏–∑–∞
- **CR –ø–æ–¥–∞—Ä–æ–∫** - –∫–æ–Ω–≤–µ—Ä—Å–∏—è –æ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–∞—Ä–∫–∞
- **CR –ø–æ–¥–ø–∏—Å–∫–∞** - –∫–æ–Ω–≤–µ—Ä—Å–∏—è –æ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–æ –ø–æ–∫—É–ø–∫–∏ (–≥–ª–∞–≤–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞!)

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- ‚úÖ CR –ø–æ–¥–ø–∏—Å–∫–∞ > 20% - –æ—Ç–ª–∏—á–Ω–æ üî•
- ‚ö†Ô∏è CR –ø–æ–¥–ø–∏—Å–∫–∞ 10-20% - —Ö–æ—Ä–æ—à–æ
- ‚ùå CR –ø–æ–¥–ø–∏—Å–∫–∞ < 10% - –Ω—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å

### CPA (Cost Per Acquisition)
–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:
```
CPA = (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ √ó CPL) / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫—É–ø–æ–∫
```

### ROI (Return on Investment)
–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º—ã:
```
ROI = ((–≤—ã—Ä—É—á–∫–∞ - –∑–∞—Ç—Ä–∞—Ç—ã) / –∑–∞—Ç—Ä–∞—Ç—ã) √ó 100%
```

- üöÄ ROI > 100% - –ø—Ä–∏–±—ã–ª—å–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞
- ‚úÖ ROI > 0% - –æ–∫—É–ø–∞–µ—Ç—Å—è
- ‚ùå ROI < 0% - —É–±—ã—Ç–æ—á–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞

---

## –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é

### –ï—Å–ª–∏ –ø–∞–¥–∞–µ—Ç –Ω–∞ —ç—Ç–∞–ø–µ 2 (–ù–∞—á–∞–ª–æ –∫–≤–∏–∑–∞):
- üé® –£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
- üñº –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É
- üí¨ –°–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å" –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω–æ–π

### –ï—Å–ª–∏ –ø–∞–¥–∞–µ—Ç –Ω–∞ —ç—Ç–∞–ø–µ 3 (–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–∏–∑–∞):
- ‚è± –°–æ–∫—Ä–∞—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤
- üìù –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏
- üéØ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä

### –ï—Å–ª–∏ –ø–∞–¥–∞–µ—Ç –Ω–∞ —ç—Ç–∞–ø–µ 4 (–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞):
- üéÅ –£–ª—É—á—à–∏—Ç—å –æ—Ñ—Ñ–µ—Ä –ø–æ–¥–∞—Ä–∫–∞
- üíé –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å 5 —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ö° –î–æ–±–∞–≤–∏—Ç—å —Å—Ä–æ—á–Ω–æ—Å—Ç—å (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)

### –ï—Å–ª–∏ –ø–∞–¥–∞–µ—Ç –Ω–∞ —ç—Ç–∞–ø–µ 6 (–ü–æ–∫—É–ø–∫–∞):
- üí∞ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—É
- üìä –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- üî• –£—Å–∏–ª–∏—Ç—å retention —Å–æ–æ–±—â–µ–Ω–∏—è

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:

**deeplink_events** - —Å–æ–±—ã—Ç–∏—è –ø–æ —Ä–µ–∫–ª–∞–º–Ω—ã–º —Å—Å—ã–ª–∫–∞–º
- `user_id` - –∫—Ç–æ –ø—Ä–∏—à–µ–ª
- `raw_link` - –ø–æ –∫–∞–∫–æ–π —Å—Å—ã–ª–∫–µ
- `resolved_category` - –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∫–≤–∏–∑–∞
- `quiz_session_id` - —Å–≤—è–∑—å —Å –∫–≤–∏–∑–æ–º
- `created_at` - –∫–æ–≥–¥–∞ –ø–µ—Ä–µ—à–µ–ª

**quiz_sessions** - —Å–µ—Å—Å–∏–∏ –∫–≤–∏–∑–æ–≤
- `user_id` - –∫—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç
- `category` - relationships/money/purpose
- `status` - in_progress/completed/cancelled
- `completed_at` - –∫–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª

**users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `free_messages_activated` - –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –ø–æ–¥–∞—Ä–æ–∫
- `last_retention_sent` - –ø–æ–ª—É—á–∏–ª retention
- `sub_date` - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
```sql
SELECT * FROM deeplink_events ORDER BY created_at DESC LIMIT 10;
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–≤–∏–∑—ã
```sql
SELECT * FROM quiz_sessions WHERE status = 'in_progress';
```

### –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ—Ä–æ–Ω–∫–∏
```sql
SELECT u.* FROM users u
JOIN deeplink_events de ON u.user_id = de.user_id
WHERE de.raw_link = 'analysis_relationships_ads';
```

---

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç—á–µ—Ç–∞ –≤ Telegram:

```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ workers.py
async def send_daily_analytics():
    stats = await get_funnel_stats()
    report = generate_report(stats)
    await bot.send_message(ADMIN_ID, report)

scheduler.add_job(send_daily_analytics, 'cron', hour=10, minute=0)
```
