# ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
**Docker Compose –∏–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ—Ç `${VAR}` –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ö–æ—Å—Ç–∞, –∞ –Ω–µ –∏–∑ env_file**

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±—Ä–∞–Ω—ã –≤—Å–µ `${VAR}` –∏–∑ `docker-compose.yml`
- –¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ `env_file: .env.prod`
- –í `environment` —Ç–æ–ª—å–∫–æ Docker-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ override'—ã

### 2. –£–±—Ä–∞–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤ Makefile
**–ë—ã–ª–æ:** `docker-compose --env-file .env.prod` (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
**–°—Ç–∞–ª–æ:** `docker-compose` (env_file —É–∂–µ –≤ YAML)

### 3. –°–æ–∑–¥–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
`scripts/safe_redeploy.sh` ‚Äî –¥–µ–ø–ª–æ–π –ë–ï–ó –ø–æ—Ç–µ—Ä–∏ –ë–î

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `DEPLOY_FIX.md` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
- `ENV_VARS_FIX_SUMMARY.md` ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `SERVER_DEPLOY_INSTRUCTIONS.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
- `DEPLOY_CHEATSHEET.md` ‚Äî –±—ã—Å—Ç—Ä–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞
- `CHANGES_SUMMARY.md` ‚Äî –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üöÄ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull

# 2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ .env.prod –Ω–∞ –º–µ—Å—Ç–µ (—Ä—è–¥–æ–º —Å docker-compose.yml)
ls -la .env.prod

# 3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å placeholder'—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
nano .env.prod
# –ó–∞–º–µ–Ω–∏:
# - HELPER_ID=your_helper_assistant_id_here
# - RELATIONSHIPS_ID=your_relationships_assistant_id_here
# - SECRET_KEY=your_yookassa_secret_key_here

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
./validate-env.sh

# 5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# 6. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Ñ–∏–∫—Å ContainerConfig)
docker rm -f soulnear_postgres soulnear_bot soulnear_api 2>/dev/null || true

# 7. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
make rebuild

# 8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
make logs-bot
```

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–ø–ª–æ–∏:

```bash
# –ü—Ä–æ—Å—Ç–æ:
./scripts/safe_redeploy.sh

# –ò–ª–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π:
docker-compose down && git pull && docker rm -f soulnear_postgres soulnear_bot soulnear_api 2>/dev/null || true && make rebuild && make logs-bot
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# 1. –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤—Å–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å UP)
docker-compose ps

# 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å (–Ω–µ –ø—É—Å—Ç—ã–µ!)
docker exec soulnear_bot env | grep -E "BOT_TOKEN|OPENAI_API_KEY"

# 3. –õ–æ–≥–∏ –±–µ–∑ –æ—à–∏–±–æ–∫
make logs-bot

# 4. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –≤ Telegram
# –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å /start
```

---

## üìã Checklist

- ‚úÖ `docker-compose.yml` ‚Äî —É–±—Ä–∞–Ω—ã `${VAR}` –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
- ‚úÖ `Makefile` ‚Äî —É–±—Ä–∞–Ω—ã –¥—É–±–ª–∏ `--env-file`
- ‚úÖ `validate-env.sh` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `.env.prod`
- ‚úÖ `scripts/safe_redeploy.sh` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–µ–ø–ª–æ–π
- ‚úÖ `.env.prod` ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–∞–≤–¥—ã –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- ‚úÖ `.gitignore` ‚Äî `.env.prod` –≤ –∏–≥–Ω–æ—Ä–µ
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Äî 5 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ù–µ—Ç `WARNING: The ... variable is not set`
- ‚úÖ –ù–µ—Ç `KeyError: 'ContainerConfig'`
- ‚úÖ –ë–î –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–¥–µ–ø–ª–æ–µ
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä—É–∑—è—Ç—Å—è –∏–∑ `.env.prod`
- ‚úÖ –î–µ–ø–ª–æ–π –∑–∞ 5 —Å–µ–∫—É–Ω–¥: `./scripts/safe_redeploy.sh`

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `DEPLOY_CHEATSHEET.md` | üìÑ –ë—ã—Å—Ç—Ä–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞ (–Ω–∞—á–Ω–∏ —Å —ç—Ç–æ–≥–æ!) |
| `SERVER_DEPLOY_INSTRUCTIONS.md` | üìñ –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é |
| `DEPLOY_FIX.md` | üîß –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã |
| `ENV_VARS_FIX_SUMMARY.md` | üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |
| `CHANGES_SUMMARY.md` | üìã –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `DOCKER_QUICKSTART.md` | üê≥ Docker quick start |
| `README.md` | üìò –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ |

---

## üî• TL;DR ‚Äî –î–ª—è –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤—ã—Ö

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
git pull
./scripts/safe_redeploy.sh
```

–ì–æ—Ç–æ–≤–æ. –†–∞–±–æ—Ç–∞–µ—Ç. –ë–î —Ü–µ–ª–∞. üöÄ

---

**–¢–µ–ø–µ—Ä—å –¥–µ–ø–ª–æ–π ‚Äî —ç—Ç–æ –∫–∞–π—Ñ, –∞ –Ω–µ –±–æ–ª—å.** üòé

